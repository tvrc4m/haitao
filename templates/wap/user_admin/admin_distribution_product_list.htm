
<link href="<{$config.weburl}>/templates/wap/css/listdis.css" rel="stylesheet" type="text/css" />
<script src="<{$config.weburl}>/script/jquery-1.4.4.min.js" type="text/javascript"></script>
<header>
	<div class="nav-w">
        <section class="nav-s iconfont"><a href="<{$config.weburl}>/main.php"><i class="fanhui_icon"></i></a></section>
        <section class="nav-c"><span>商品管理</span></section>
        <section class="nav-e"><a id="list" href="<{$config.weburl}>"><i class="home_icon"></i></a></section>
    </div>
</header>


<section class="itemSearchList">

<div class="itemSearchResult clearfix">
  <{foreach item=list from=$dist_pro}>
    <dl>
        <dt><a class="p-img" href="<{$config.weburl}>/?m=product&s=detail&id=<{$list.id}>&shop_id=<{$shop_id}>">  <img alt="" src="<{if !$list.pic }><{$config.weburl}>/image/default/nopic.gif<{else}><{$list.pic}>_60X60.jpg<{/if}>" class="shop_src"></a> </dt>
        <dd>
            <p class="p-name">
                <{if $list.p_national }>
                    <span class="pname_img">
                        <img src="<{$list.p_national.img}>">&nbsp;&nbsp;<{$list.p_national.title}>
                    </span>
                <{/if}>
                &nbsp;&nbsp;
                <a target="_blank" href="<{$config.weburl}>/?m=product&s=detail&id=<{$list.id}>&shop_id=<{$shop_id}>" class="shop_name"><{$list.pname|truncate:30:""}></a>
                <span class="price">（剩<{$list.amount}>件）</span>
            </p>
            <p class="p-name color">  
				<span class="price-w">
				价格：<span class="price-tests"><{$config.money}><{$list.price|number_format:2}></span> 
				</span>
				<span class="complateMoney">
					<{if $list.is_dist}>佣金: <span class="price-tests"><{$config.money}><{$list.commission_product_price_0|number_format:2}></span><{/if}>
				</span>
			</p>
			<div class="price-btns">
				<span class="price-delate"><a href="javascript:void(0);">删除</a></span>
				<{if $list.is_dist}><span class="price-fenxiang price">分享</span><{/if}>
			</div>
        </dd>
    </dl>
   <{foreachelse}>
<div class="itemsNull">
    <h3>没有搜索到相关宝贝</h3>
</div>
    <{/foreach}>
</section>

<a href="javascript:void(0);" class="m_jiazai">下滑加载更多</a>

<{if $smarty.session.appid}>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript">
    var cnf = {
        //debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
        appId: '<{$smarty.session.appid}>',       // 必填，公众号的唯一标识
        timestamp: '<{$smarty.session.tmpTime}>', // 必填，生成签名的时间戳
        nonceStr: '<{$smarty.session.noncestr}>', // 必填，生成签名的随机串
        signature: '<{$smarty.session.signature}>',// 必填，签名，见附录1
        jsApiList: ['onMenuShareQQ','onMenuShareTimeline','onMenuShareWeibo','onMenuShareAppMessage','downloadImage','checkJsApi'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
    };

    wx.config(cnf);
    wx.ready(function(){
        wx.onMenuShareTimeline({
            title: "<{$com.shop_title}>", // 分享标题
            link: location.href, // 分享链接
            imgUrl: "<{if $com.logo}><{$com.logo}><{else}>image/default/nopic.gif<{/if}>", // 分享图标
            success: function () {
                // 用户确认分享后执行的回调函数
                /*
                var url = "<{$config.weburl}>/ajax_back_end.php";
                $.post(url,{"uid":'<{$buid}>',"shopid":'<{$smarty.get.uid}>',"type":'1'},function(data){
                })
                */
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        });

        wx.onMenuShareAppMessage({
            title:"<{$com.shop_title}>", // 分享标题
            desc: "<{$com.shop_description|truncate:32:'.....'}>\n好评率：<{if $comment==0}>100<{else}><{$comment|number_format:2}><{/if}>%\n<{$com.area}>", // 分享描述
            link: location.href, // 分享链接
            imgUrl: "<{if $com.logo}><{$com.logo}><{else}>image/default/nopic.gif<{/if}>", // 分享图标
            type: '', // 分享类型,music、video或link，不填默认为link
            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
            success: function () {
                // 用户确认分享后执行的回调函数
                /*
                var url = "<{$config.weburl}>/ajax_back_end.php";
                $.post(url,{"uid":'<{$buid}>',"shopid":'<{$smarty.get.uid}>',"type":'1'},function(data){
                })
                */
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        })

        wx.onMenuShareQQ({
            title: '<{$com.shop_title}>', // 分享标题
            desc: '<{$com.shop_description|truncate:32:'.....'}>\n好评率：<{if $comment==0}>100<{else}><{$comment|number_format:2}><{/if}>%\n<{$com.area}>', // 分享描述
            link: location.href, // 分享链接
            imgUrl: '<{if $com.logo}><{$com.logo}><{else}>image/default/nopic.gif<{/if}>', // 分享图标
            success: function () {
                // 用户确认分享后执行的回调函数
                /*
                var url = "<{$config.weburl}>/ajax_back_end.php";
                $.post(url,{"uid":'<{$buid}>',"shopid":'<{$smarty.get.uid}>',"type":'1'},function(data){
                })
                */
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        });

        wx.onMenuShareWeibo({
            title: '<{$com.shop_title}>', // 分享标题
            desc: '<{$com.shop_description|truncate:32:'.....'}>\n好评率：<{if $comment==0}>100<{else}><{$comment|number_format:2}><{/if}>%\n<{$com.area}>', // 分享描述
            link: location.href, // 分享链接
            imgUrl: '<{if $com.logo}><{$com.logo}><{else}>image/default/nopic.gif<{/if}>', // 分享图标
            success: function () {
                // 用户确认分享后执行的回调函数
                /*
                var url = "<{$config.weburl}>/ajax_back_end.php";
                $.post(url,{"uid":'<{$buid}>',"shopid":'<{$smarty.get.uid}>',"type":'1'},function(data){
                })
                */
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        });
    })
</script>
<{else}>
<{/if}>
<script type="text/javascript">

/*$(function(){
	function collect_altr(cla){
        $(cla).append("<div class='am-dialog-mask'></div>"+
				"<div class='price-btns-context'>"+
					"<div class='price-btns-context-top clearfix'>"+
						"<div class='context-top-list context-top-listb' id='frinds'>"+
							"<img src='../../../image/wap/../../../image/wap/wap_haitao_icon66.png'>"+
							"<p>微信好友</p>"+
						"</div>"+
						"<div class='context-top-list' id='goods'>"+
							"<img src='../../../image/wap/../../../image/wap/wap_haitao_icon58.png'>"+
							"<p style='margin-top:5px'>朋友圈</p>"+
						"</div>"+
					"</div>"+
				"</div>")
        $(".am-dialog-mask").addClass("am-dialog-mask-test");
        $(".price-btns-context").addClass('price-btns-context_test');
    }
    function collect_confirm(cla){
        $(cla).append("<div class='am-dialog-mask'></div>"+
				"<div class='price-btns-contexts'>"+
					"<div class='price-btns-context-tops clearfix'>"+
						"<p>确信删除?</P>"+
					"</div>"+
					"<div class='detate-btns-context-bot'><a href='javascript:void(0);'>确定</a><a href='javascript:void(0);'>取消</a></div>"+
				"</div>")
        $(".am-dialog-mask").addClass("am-dialog-mask-test");
        $(".price-btns-contexts").addClass('price-btns-contexts_test');
        $(".detate-btns-context-bot a:first-child").bind("click",function(){
	    	location.href="<{$config.weburl}>/main.php?deid=<{$list.id}>&m=distribution&s=admin_distribution_product_list"
	    })
	    $(".detate-btns-context-bot a:last-child").bind("click",function(){
	    	location.href="<{$config.weburl}>/main.php?m=distribution&s=admin_distribution_product_list"
	    })
    }
    $(".price-fenxiang").bind("click",function(){
    	var shopTitle=$(this).parent().parent().parent().find(".shop_name").html();
    	var shopSrc=$(this).parent().parent().parent().find(".shop_src").attr("src");
    	var shopLink=$(this).parent().parent().parent().find(".shop_name").attr("href");
    	var shopDesc=$(this).parent().parent().parent().find(".shop_name").html();
    	console.log(shopTitle);
    	console.log(shopSrc);
    	console.log(shopLink);
    	collect_altr(".price-btns");
    	$("#frinds").live("click",function(){
	    	WeiXinSendAppMessage();
	    })
	    $("#goods").live("click",function(){
	    	WeiXinShareBtn();
	    })

	    function WeiXinShareBtn() { 
			if (typeof WeixinJSBridge == "undefined") { 
				alert("请先通过微信搜索 蚂蚁海淘 添加蚂蚁海淘为好友，通过微信分享文章 "); 
			} else { 
				 WeixinJSBridge.invoke('shareTimeline', { 
					 "title": 'shopTitle', 
					 "link": 'shopLink', 
					 "desc": 'shopTitle', 
					 "img_url": 'shopSrc' 
				 }); 
			} 
		 }
		  function WeiXinSendAppMessage() { 
			if (typeof WeixinJSBridge == "undefined") { 
				alert("请先通过微信搜索 蚂蚁海淘 添加蚂蚁海淘为好友，通过微信分享文章 "); 
			} else { 
				 WeixinJSBridge.invoke('sendAppMessage', { 
					 "title": "1111111", 
					 "link": 'shopLink', 
					 "desc": 'shopTitle', 
					 "img_url": 'shopSrc' 
				 }); 
			} 
		 }
    })
    $(".price-delate").bind("click",function(){
    	collect_confirm(".price-btns");
    })

})*/

$(function(){
    var dlLen=$(".itemSearchResult dl").size();
    if(dlLen<10){
        $(".m_jiazai").hide();
        $("footer").css({"margin-top":"20px"})
    }
    var page = 0;
    var url = "<{$config.weburl}>/";
    var id = "<{$smarty.get.deid}>";
    var stop=true; 
    $(window).scroll(function(){
        totalheight = parseFloat(window.innerHeight) + parseFloat($(window).scrollTop())+ parseFloat($("footer").height());      
        if($(document).height() <= totalheight){
            if(stop==true){ 
                $(".m_jiazai").html("正在加载中.....");
                stop=false; 
                page = parseInt(parseInt(page) + 10);
                 $.ajax({
                    url: url,
                    type: 'get',
                    data: {id:id, page:page, m:"distribution", s:"admin_distribution_product_ajax_list"},
                    dataType: "json",
                    success: function(msg){
                        if(msg.status==2){
                            var dataLen=msg.data.length;
                            for(var i=0;i<dataLen;i++){
                                var value_substr=msg.data[i].pname.substr(i,19); 
                                 $(".itemSearchResult").append("<dl><dt><a class='p-img' href='<{$config.weburl}>/?m=product&s=detail&id="+msg.data[i].id+"&shop_id=<{$shop_id}>'>  <img alt='"+msg.data[i].pname+"' src='<{if !$list.pic }><{$config.weburl}>/image/default/nopic.gif<{else}>"+msg.data[i].pic+"<{/if}>' class='shop_src'></a></dt>"+
                                    "<dd>"+
                                       "<p class='p-name'>"+
                                            "<{if $list.p_national }>"+
                                                "<span class='pname_img'>"+
                                                    "<img src='<{$list.p_national.img}>'>&nbsp;&nbsp;<{$list.p_national.title}>"+
                                                "</span>"+
                                            "<{/if}>"+
                                            "&nbsp;&nbsp;"+
                                            "<a target='_blank' href='<{$config.weburl}>/?m=product&s=detail&id=<{$list.id}>&shop_id=<{$shop_id}>' class='shop_name'>"+value_substr+"</a>"+
                                            "<span class='price'>（剩"+msg.data[i].amount+"件）</span>"+
                                        "</p>"+
                                        "<p class='p-name color'>"+  
                                           "<span class='price-w'>"+
                                            "价格：<span class='price-tests'><{$config.money}>"+msg.data[i].price+"</span>"+ 
                                            "</span>"+
                                            "<span class='complateMoney'>"+
                                                "<{if $list.is_dist}>佣金: <span class='price-tests'><{$config.money}>"+msg.data[i].share_money+"</span><{/if}>"+
                                            "</span>"+
                                        "</p>"+
                                        "<div class='price-btns'>"+
                                            "<span class='price-delate'><a href='javascript:void(0);'>删除</a></span>"+
                                            "<{if $list.is_dist}><span class='price-fenxiang price'>分享</span><{/if}>"+
                                        "</div>"+
                                    "</dd></dl>")   
                            }
                            stop=true;
                        }else{
                         $(".m_jiazai").html("已到最底部");
                        }
                    }
                });
            } 
        } 
    })      
})
</script>
